# ドメインモデルのリファクタリング

1. レンタル料金取得メソッドを抽出
2. レンタル料金抽出メソッドを移動
3. レンタル料金抽出メソッド名を変更
4. レンタルポイント取得メソッドを抽出
5. レンタルポイント取得メソッドを移動
6. Rentalsクラスの導入
7. レンタル料金とレンタルポイントの計算を分離
8. レンタルポイント計算メソッドを抽出
9. レンタルポイント計算メソッドをRentalsクラスに移動
10. 料金計算メソッドを抽出
11. 料金計算メソッドをRentalsクラスに移動
12. Priceインターフェースの導入
13. レンタルクラスのchargeメソッドからswitchを除去
14. PriceTypeをMovieTypeに名前変更
15. Pointインターフェースの導入
16. rentalパッケージを作成

リファクタリングの結果、`Customer`クラスから`Point`, `Price`, `Rentals` クラスにドメインロジックが移動されたので、  
`CustomerTest`クラスはなくなり,
 - `NewReleasePointTest`
 - `ChildrenPriceTest`, `NewReleasePriceTest`, `RegularPrice` 
 - `RentalsTest`

 - のシンプルなテストに変わります.

```java
class NewReleasePointTest {
    @Test
    void 新作を1日レンタルするポイント() {
        NewReleasePoint sut = new NewReleasePoint();
        assertEquals(1, sut.frequentRenterPoints(1));
    }

    @Test
    void 新作を2日レンタルするポイント() {
        NewReleasePoint sut = new NewReleasePoint();
        assertEquals(2, sut.frequentRenterPoints(2));
    }
}
```

```java
class RegularPriceTest {

    @Test
    void 旧作を2日レンタルする料金() {
        RegularPrice sut = new RegularPrice();
        assertEquals(2, sut.charge(2));
    }

    @Test
    void 旧作を3日レンタルする料金() {
        RegularPrice sut = new RegularPrice();
        assertEquals(3.5, sut.charge(3));
    }
}
```

```java 
package video.domain.rental;

import org.junit.jupiter.api.Test;
import video.domain.movie.Movie;
import video.domain.movie.MovieType;

import static org.junit.jupiter.api.Assertions.*;

class RentalsTest {

    Movie 子供用作品_となりのトトロ = new Movie("となりのトトロ", MovieType.CHILDREN);
    Movie 旧作_トップガン = new Movie("トップガン", MovieType.REGULAR);
    Movie 新作_君たちはどう生きるか = new Movie("君たちはどう生きるか", MovieType.NEW_RELEASE);

    @Test
    void 新作と旧作と子供用ビデオのレンタルのポイント() {
        Rentals rentals = new Rentals();
        rentals.add(new Rental(子供用作品_となりのトトロ, 6));
        rentals.add(new Rental(旧作_トップガン, 7));
        rentals.add(new Rental(新作_君たちはどう生きるか, 7));

        double frequentRenterPoints = rentals.frequentRenterPoints();

        assertEquals(4, frequentRenterPoints);

    }

    @Test
    void 新作と旧作と子供用ビデオのレンタルの料金() {
        Rentals rentals = new Rentals();
        rentals.add(new Rental(子供用作品_となりのトトロ, 6));
        rentals.add(new Rental(旧作_トップガン, 7));
        rentals.add(new Rental(新作_君たちはどう生きるか, 7));

        double totalAmount = rentals.totalAmount();

        assertEquals(36.5, totalAmount);
    }
}
```