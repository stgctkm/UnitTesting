# モックの利用とテストの壊れやすさ
- テストダブル
  - テストで使用されるプロダクションコードには含まれない依存
  - モック
    - スパイ、モック
    - 外部に向かうコミュニケーション（出力）を模倣
    
  - スタブ
    - ダミー、フェイク、スタブ
    - 内部に向かうコミュニケーション（入力）を模倣
    - スタブとのやりとりを検証するのはテストを壊れやすくする
- コマンド・クエリ分離の原則
  - コマンドの代わりがモック
  - クエリの代わりがスタブ
- 観察可能な振る舞いと実装の詳細
  - 観察可能な振る舞いは下記のいずれか
    - クライアントが目標を達成するために使う公開された操作
    - クライアントが目標を達成するために使う公開された状態
- きちんと設計されたコードは観察可能な振る舞いが公開されたAPIと一致
- カプセル化とは不変条件（invariant）の侵害からコードを守る手段
- ヘキサゴナル・アーキテクチャー
  - ドメイン層とアプリケーションサービス層の2層で構成される
- ヘキサゴナル・アーキテクチャーの3つの性質
  - ドメイン層とアプリケーションサービス層との関心の分離
  - アプリケーションサービス層からドメイン層へ依存
  - 外部アプリケーションはアプリケーションサービス層のインターフェースを経由してドメイン層にアクセス
- アプリケーションサービスは観察可能な振る舞いだけを公開する
- システム内コミュニケーションとシステム間コミュニケーション
  - システム内コミュニケーションは実装の詳細
  - システム間コミュニケーションは観察可能な振る舞い
- システム内コミュニケーションにモックを使うとテストを壊れやすくする
- 副作用を外部から観察できるシステム間コミュニケーションにのみモックを使用できる